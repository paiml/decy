<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Complexity Analysis</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="complexity-analysis"><a class="header" href="#complexity-analysis">Complexity Analysis</a></h1>
<p>Code complexity measures how difficult code is to understand and maintain. DECY enforces <strong>low complexity</strong> for all functions.</p>
<h2 id="why-complexity-matters"><a class="header" href="#why-complexity-matters">Why Complexity Matters</a></h2>
<p>Complex code is:</p>
<ul>
<li><strong>Harder to understand</strong>: More mental overhead</li>
<li><strong>More bug-prone</strong>: More paths = more potential bugs</li>
<li><strong>Harder to test</strong>: Need more test cases</li>
<li><strong>Harder to maintain</strong>: Changes are risky</li>
</ul>
<p>Simple code is:</p>
<ul>
<li><strong>Easier to understand</strong>: Clear logic flow</li>
<li><strong>Less bug-prone</strong>: Fewer edge cases</li>
<li><strong>Easier to test</strong>: Fewer paths to cover</li>
<li><strong>Easier to maintain</strong>: Safe to modify</li>
</ul>
<h2 id="cyclomatic-complexity"><a class="header" href="#cyclomatic-complexity">Cyclomatic Complexity</a></h2>
<p>Cyclomatic complexity counts the number of independent paths through code.</p>
<h3 id="formula"><a class="header" href="#formula">Formula</a></h3>
<pre><code>CC = E - N + 2P

E = edges in control flow graph
N = nodes in control flow graph
P = connected components (usually 1)

Simplified: CC = number of decision points + 1
</code></pre>
<h3 id="thresholds"><a class="header" href="#thresholds">Thresholds</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Complexity</th><th>Rating</th><th>Description</th></tr></thead><tbody>
<tr><td>1-5</td><td>âœ… Simple</td><td>Easy to understand</td></tr>
<tr><td>6-10</td><td>âš ï¸ Moderate</td><td>Still manageable</td></tr>
<tr><td>11-20</td><td>âŒ Complex</td><td>Should refactor</td></tr>
<tr><td>21+</td><td>ğŸš¨ Very Complex</td><td>Must refactor</td></tr>
</tbody></table>
</div>
<p><strong>DECY Target</strong>: â‰¤10 for all functions</p>
<h2 id="example-simple-function-cc--1"><a class="header" href="#example-simple-function-cc--1">Example: Simple Function (CC = 1)</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn add(a: i32, b: i32) -&gt; i32 {
    a + b  // No branches = CC 1
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Complexity</strong>: 1 (simplest possible)</p>
<h2 id="example-one-branch-cc--2"><a class="header" href="#example-one-branch-cc--2">Example: One Branch (CC = 2)</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn abs(x: i32) -&gt; i32 {
    if x &lt; 0 {    // +1 decision point
        -x
    } else {
        x
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Complexity</strong>: 2 (1 decision point + 1 = 2)</p>
<h2 id="example-multiple-branches-cc--4"><a class="header" href="#example-multiple-branches-cc--4">Example: Multiple Branches (CC = 4)</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn classify(x: i32) -&gt; &amp;'static str {
    if x &lt; 0 {        // +1
        "negative"
    } else if x == 0 { // +1
        "zero"
    } else if x &lt; 10 { // +1
        "small positive"
    } else {
        "large positive"
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Complexity</strong>: 4 (3 decision points + 1 = 4)</p>
<h2 id="example-loop-cc--3"><a class="header" href="#example-loop-cc--3">Example: Loop (CC = 3)</a></h2>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn sum_positive(arr: &amp;[i32]) -&gt; i32 {
    let mut total = 0;
    for &amp;x in arr {     // +1 (loop)
        if x &gt; 0 {      // +1 (if)
            total += x;
        }
    }
    total
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Complexity</strong>: 3 (loop + if + 1 = 3)</p>
<h2 id="decy-complexity-analysis"><a class="header" href="#decy-complexity-analysis">DECY Complexity Analysis</a></h2>
<h3 id="parser-average-cc--42"><a class="header" href="#parser-average-cc--42">Parser: Average CC = 4.2</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Simple: CC = 2
pub fn is_pointer_type(ty: &amp;HirType) -&gt; bool {
    matches!(ty, HirType::Pointer(_))  // +1 (match)
}

// Moderate: CC = 5
pub fn parse_type(tokens: &amp;[Token]) -&gt; Result&lt;HirType&gt; {
    match tokens[0] {           // +1
        Token::Int =&gt; Ok(HirType::Int),
        Token::Char =&gt; Ok(HirType::Char),
        Token::Void =&gt; Ok(HirType::Void),
        Token::Star =&gt; {
            if tokens.len() &gt; 1 {  // +1
                let inner = parse_type(&amp;tokens[1..])?;
                Ok(HirType::Pointer(Box::new(inner)))
            } else {               // +1
                Err(anyhow!("Expected type after *"))
            }
        }
        _ =&gt; Err(anyhow!("Unknown type")),  // +1
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Average</strong>: Well within target (â‰¤10)</p>
<h3 id="hir-average-cc--38"><a class="header" href="#hir-average-cc--38">HIR: Average CC = 3.8</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Simple: CC = 1
pub fn get_name(&amp;self) -&gt; &amp;str {
    &amp;self.name
}

// Simple: CC = 2
pub fn is_void(&amp;self) -&gt; bool {
    matches!(self.return_type, HirType::Void)  // +1
}

// Moderate: CC = 4
pub fn from_ast_function(ast_func: &amp;AstFunction) -&gt; Self {
    let params = ast_func.parameters()
        .iter()                              // +1 (implicit loop)
        .map(|p| HirParameter::from_ast_parameter(p))
        .collect();

    let body = if let Some(ast_body) = ast_func.body() {  // +1
        ast_body.iter()                      // +1 (implicit loop)
            .map(|stmt| HirStatement::from_ast_statement(stmt))
            .collect()
    } else {
        vec![]
    };

    HirFunction::new_with_body(
        ast_func.name(),
        params,
        HirType::from_ast_type(ast_func.return_type()),
        body,
    )
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Average</strong>: Excellent (well below target)</p>
<h3 id="ownership-inference-average-cc--62"><a class="header" href="#ownership-inference-average-cc--62">Ownership Inference: Average CC = 6.2</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Moderate: CC = 6
pub fn classify_ownership(source: &amp;Source, graph: &amp;DataflowGraph) -&gt; OwnershipPattern {
    match source {                          // +1
        Source::Malloc =&gt; {
            if escapes_scope(graph) {       // +1
                OwnershipPattern::Owning
            } else {
                OwnershipPattern::Borrowed  // +1
            }
        }
        Source::Parameter =&gt; {
            if is_mutated(graph) {          // +1
                OwnershipPattern::Borrowed  // (mutable)
            } else {
                OwnershipPattern::Borrowed  // +1 (immutable)
            }
        }
        Source::PointerArithmetic =&gt; OwnershipPattern::Raw,
        _ =&gt; OwnershipPattern::Raw,
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Average</strong>: Good (within target)</p>
<h3 id="codegen-average-cc--54"><a class="header" href="#codegen-average-cc--54">Codegen: Average CC = 5.4</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Moderate: CC = 7
pub fn generate_statement(&amp;mut self, stmt: &amp;HirStatement) -&gt; String {
    match stmt {                                    // +1
        HirStatement::VariableDeclaration { name, ty, initializer } =&gt; {
            let rust_type = self.map_type(ty);
            if let Some(init) = initializer {       // +1
                format!("let mut {}: {} = {};", name, rust_type,
                    self.generate_expression(init))
            } else {                                // +1
                format!("let mut {}: {};", name, rust_type)
            }
        }
        HirStatement::Assignment { target, value } =&gt; {
            format!("{} = {};", target, self.generate_expression(value))
        }
        HirStatement::Return(expr) =&gt; {
            if let Some(e) = expr {                 // +1
                format!("return {};", self.generate_expression(e))
            } else {                                // +1
                "return;".to_string()
            }
        }
        HirStatement::If { condition, then_block, else_block } =&gt; {
            let mut result = format!("if {} {{\n", self.generate_expression(condition));
            for stmt in then_block {
                result.push_str(&amp;format!("    {}\n", self.generate_statement(stmt)));
            }
            if let Some(else_stmts) = else_block {  // +1
                result.push_str("} else {\n");
                for stmt in else_stmts {
                    result.push_str(&amp;format!("    {}\n", self.generate_statement(stmt)));
                }
            }                                       // +1
            result.push('}');
            result
        }
        _ =&gt; String::new(),
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Average</strong>: Good (within target)</p>
<h2 id="complexity-report"><a class="header" href="#complexity-report">Complexity Report</a></h2>
<pre><code>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   Complexity Analysis: DECY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ Crate: decy-parser
   Functions analyzed:    45
   Average complexity:    4.2
   Max complexity:        8 (parse_declaration)
   Functions &gt; 10:        0
   Status:               âœ… PASS

ğŸ“¦ Crate: decy-hir
   Functions analyzed:    63
   Average complexity:    3.8
   Max complexity:        6 (from_ast_function)
   Functions &gt; 10:        0
   Status:               âœ… PASS

ğŸ“¦ Crate: decy-ownership
   Functions analyzed:    89
   Average complexity:    6.2
   Max complexity:        9 (infer_lifetime_constraints)
   Functions &gt; 10:        0
   Status:               âœ… PASS

ğŸ“¦ Crate: decy-codegen
   Functions analyzed:    112
   Average complexity:    5.4
   Max complexity:        9 (generate_function_with_lifetimes)
   Functions &gt; 10:        0
   Status:               âœ… PASS

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TOTAL
   Functions analyzed:    309
   Average complexity:    5.1
   Max complexity:        9
   Functions &gt; 10:        0

Status: âœ… ALL FUNCTIONS WITHIN TARGET (â‰¤10)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
</code></pre>
<p><strong>Result</strong>: All functions â‰¤10 complexity âœ…</p>
<h2 id="measuring-complexity"><a class="header" href="#measuring-complexity">Measuring Complexity</a></h2>
<h3 id="using-cargo-complexity"><a class="header" href="#using-cargo-complexity">Using cargo-complexity</a></h3>
<pre><code class="language-bash"># Install
cargo install cargo-complexity

# Analyze entire workspace
cargo complexity --all

# Analyze specific crate
cargo complexity --package decy-parser

# Show only high complexity functions
cargo complexity --threshold 10

# Generate JSON report
cargo complexity --json &gt; complexity.json
</code></pre>
<h3 id="example-output"><a class="header" href="#example-output">Example Output</a></h3>
<pre><code>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Function                                    CC    Lines
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
decy_parser::parse_statement                 8      42
decy_hir::from_ast_function                  6      35
decy_ownership::classify_ownership           6      28
decy_codegen::generate_statement             7      48
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
</code></pre>
<h2 id="reducing-complexity"><a class="header" href="#reducing-complexity">Reducing Complexity</a></h2>
<h3 id="strategy-1-extract-functions"><a class="header" href="#strategy-1-extract-functions">Strategy 1: Extract Functions</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// âŒ Before: CC = 12 (too complex!)
pub fn process_pointer(ptr: &amp;Pointer, graph: &amp;DataflowGraph) -&gt; Result&lt;RustCode&gt; {
    if ptr.is_null() {
        return Err(anyhow!("null pointer"));
    }

    let ownership = if is_malloc(ptr) {
        if escapes_scope(ptr, graph) {
            OwnershipPattern::Owning
        } else {
            OwnershipPattern::Borrowed
        }
    } else if is_parameter(ptr) {
        if is_mutated(ptr, graph) {
            OwnershipPattern::BorrowedMut
        } else {
            OwnershipPattern::Borrowed
        }
    } else {
        OwnershipPattern::Raw
    };

    let rust_type = match ownership {
        OwnershipPattern::Owning =&gt; format!("Box&lt;{}&gt;", ptr.inner_type()),
        OwnershipPattern::Borrowed =&gt; format!("&amp;{}", ptr.inner_type()),
        OwnershipPattern::BorrowedMut =&gt; format!("&amp;mut {}", ptr.inner_type()),
        OwnershipPattern::Raw =&gt; format!("*mut {}", ptr.inner_type()),
    };

    Ok(RustCode::new(rust_type))
}

// âœ… After: CC = 3 (much better!)
pub fn process_pointer(ptr: &amp;Pointer, graph: &amp;DataflowGraph) -&gt; Result&lt;RustCode&gt; {
    if ptr.is_null() {  // +1
        return Err(anyhow!("null pointer"));
    }

    let ownership = classify_ownership(ptr, graph);  // Extracted!
    let rust_type = generate_rust_type(ptr, ownership);  // Extracted!

    Ok(RustCode::new(rust_type))
}

// Helper functions (each simple)
fn classify_ownership(ptr: &amp;Pointer, graph: &amp;DataflowGraph) -&gt; OwnershipPattern {
    if is_malloc(ptr) {  // CC = 3
        if escapes_scope(ptr, graph) {
            OwnershipPattern::Owning
        } else {
            OwnershipPattern::Borrowed
        }
    } else if is_parameter(ptr) {  // CC = 3
        if is_mutated(ptr, graph) {
            OwnershipPattern::BorrowedMut
        } else {
            OwnershipPattern::Borrowed
        }
    } else {
        OwnershipPattern::Raw
    }
}

fn generate_rust_type(ptr: &amp;Pointer, ownership: OwnershipPattern) -&gt; String {
    match ownership {  // CC = 2
        OwnershipPattern::Owning =&gt; format!("Box&lt;{}&gt;", ptr.inner_type()),
        OwnershipPattern::Borrowed =&gt; format!("&amp;{}", ptr.inner_type()),
        OwnershipPattern::BorrowedMut =&gt; format!("&amp;mut {}", ptr.inner_type()),
        OwnershipPattern::Raw =&gt; format!("*mut {}", ptr.inner_type()),
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Result</strong>: Original CC=12 â†’ 3 separate functions with CC=3,3,2</p>
<h3 id="strategy-2-use-match-instead-of-if-else-chains"><a class="header" href="#strategy-2-use-match-instead-of-if-else-chains">Strategy 2: Use Match Instead of If-Else Chains</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// âŒ Before: CC = 6
pub fn classify_type(ty: &amp;str) -&gt; TypeClass {
    if ty == "int" || ty == "long" || ty == "short" {
        TypeClass::Integer
    } else if ty == "float" || ty == "double" {
        TypeClass::Float
    } else if ty == "char" {
        TypeClass::Character
    } else if ty == "void" {
        TypeClass::Void
    } else {
        TypeClass::Unknown
    }
}

// âœ… After: CC = 2
pub fn classify_type(ty: &amp;str) -&gt; TypeClass {
    match ty {  // +1
        "int" | "long" | "short" =&gt; TypeClass::Integer,
        "float" | "double" =&gt; TypeClass::Float,
        "char" =&gt; TypeClass::Character,
        "void" =&gt; TypeClass::Void,
        _ =&gt; TypeClass::Unknown,
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Result</strong>: CC reduced from 6 â†’ 2</p>
<h3 id="strategy-3-early-returns"><a class="header" href="#strategy-3-early-returns">Strategy 3: Early Returns</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// âŒ Before: CC = 5 (nested conditions)
pub fn validate_pointer(ptr: &amp;Pointer) -&gt; Result&lt;()&gt; {
    if !ptr.is_null() {
        if ptr.has_valid_type() {
            if ptr.is_aligned() {
                if ptr.in_valid_range() {
                    Ok(())
                } else {
                    Err(anyhow!("out of range"))
                }
            } else {
                Err(anyhow!("misaligned"))
            }
        } else {
            Err(anyhow!("invalid type"))
        }
    } else {
        Err(anyhow!("null pointer"))
    }
}

// âœ… After: CC = 5 (but much more readable!)
pub fn validate_pointer(ptr: &amp;Pointer) -&gt; Result&lt;()&gt; {
    if ptr.is_null() {  // +1
        return Err(anyhow!("null pointer"));
    }
    if !ptr.has_valid_type() {  // +1
        return Err(anyhow!("invalid type"));
    }
    if !ptr.is_aligned() {  // +1
        return Err(anyhow!("misaligned"));
    }
    if !ptr.in_valid_range() {  // +1
        return Err(anyhow!("out of range"));
    }
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Result</strong>: Same CC but much more readable (linear flow)</p>
<h3 id="strategy-4-use-iterators"><a class="header" href="#strategy-4-use-iterators">Strategy 4: Use Iterators</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// âŒ Before: CC = 4
pub fn count_positive(arr: &amp;[i32]) -&gt; usize {
    let mut count = 0;
    for &amp;x in arr {  // +1
        if x &gt; 0 {   // +1
            if x &lt; 100 {  // +1
                count += 1;
            }
        }
    }
    count
}

// âœ… After: CC = 1
pub fn count_positive(arr: &amp;[i32]) -&gt; usize {
    arr.iter()
        .filter(|&amp;&amp;x| x &gt; 0 &amp;&amp; x &lt; 100)
        .count()
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Result</strong>: CC reduced from 4 â†’ 1</p>
<h2 id="cognitive-complexity"><a class="header" href="#cognitive-complexity">Cognitive Complexity</a></h2>
<p>Cognitive complexity measures how hard code is to understand (not just paths).</p>
<h3 id="differences-from-cyclomatic-complexity"><a class="header" href="#differences-from-cyclomatic-complexity">Differences from Cyclomatic Complexity</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Code Pattern</th><th>Cyclomatic</th><th>Cognitive</th></tr></thead><tbody>
<tr><td>Simple if</td><td>+1</td><td>+1</td></tr>
<tr><td>Nested if</td><td>+1</td><td>+2 (nesting penalty)</td></tr>
<tr><td>else if</td><td>+1</td><td>+1</td></tr>
<tr><td>else</td><td>0</td><td>0</td></tr>
<tr><td>Short-circuit &amp;&amp;</td><td>+1</td><td>+1</td></tr>
<tr><td>Loop</td><td>+1</td><td>+1</td></tr>
<tr><td>Nested loop</td><td>+1</td><td>+2 (nesting penalty)</td></tr>
</tbody></table>
</div>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Cyclomatic = 4, Cognitive = 7
pub fn complex_check(x: i32, y: i32) -&gt; bool {
    if x &gt; 0 {              // +1 CC, +1 cognitive
        if y &gt; 0 {          // +1 CC, +2 cognitive (nested)
            if x &gt; y {      // +1 CC, +3 cognitive (double nested)
                true
            } else {
                false
            }
        } else {
            false
        }
    } else {
        false
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>DECY Target</strong>: Cognitive complexity â‰¤15</p>
<h2 id="testing-complex-functions"><a class="header" href="#testing-complex-functions">Testing Complex Functions</a></h2>
<p>Complex functions need more tests:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// CC = 6 â†’ needs at least 6 test cases
pub fn classify(x: i32) -&gt; &amp;'static str {
    if x &lt; -100 {         // +1
        "very negative"
    } else if x &lt; 0 {     // +1
        "negative"
    } else if x == 0 {    // +1
        "zero"
    } else if x &lt; 10 {    // +1
        "small"
    } else if x &lt; 100 {   // +1
        "medium"
    } else {
        "large"
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_very_negative() {
        assert_eq!(classify(-150), "very negative");  // Path 1
    }

    #[test]
    fn test_negative() {
        assert_eq!(classify(-50), "negative");  // Path 2
    }

    #[test]
    fn test_zero() {
        assert_eq!(classify(0), "zero");  // Path 3
    }

    #[test]
    fn test_small() {
        assert_eq!(classify(5), "small");  // Path 4
    }

    #[test]
    fn test_medium() {
        assert_eq!(classify(50), "medium");  // Path 5
    }

    #[test]
    fn test_large() {
        assert_eq!(classify(150), "large");  // Path 6
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Rule</strong>: Minimum test cases â‰¥ cyclomatic complexity</p>
<h2 id="cicd-integration"><a class="header" href="#cicd-integration">CI/CD Integration</a></h2>
<pre><code class="language-yaml">name: Complexity Check

on: [push, pull_request]

jobs:
  complexity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable

      - name: Install cargo-complexity
        run: cargo install cargo-complexity

      - name: Check complexity
        run: |
          cargo complexity --threshold 10 --json &gt; complexity.json

          # Check if any functions exceed threshold
          HIGH_COMPLEXITY=$(jq '[.functions[] | select(.complexity &gt; 10)] | length' complexity.json)

          if [ "$HIGH_COMPLEXITY" -gt 0 ]; then
            echo "âŒ Found $HIGH_COMPLEXITY functions with complexity &gt; 10"
            jq '.functions[] | select(.complexity &gt; 10)' complexity.json
            exit 1
          fi

          echo "âœ… All functions within complexity threshold"
</code></pre>
<h2 id="complexity-best-practices"><a class="header" href="#complexity-best-practices">Complexity Best Practices</a></h2>
<h3 id="do-"><a class="header" href="#do-">DO âœ…</a></h3>
<ul>
<li><strong>Extract functions</strong>: Break down complex logic</li>
<li><strong>Use early returns</strong>: Avoid deep nesting</li>
<li><strong>Prefer match</strong>: More readable than if-else chains</li>
<li><strong>Use iterators</strong>: Reduce loop complexity</li>
<li><strong>Test all paths</strong>: CC = minimum test count</li>
</ul>
<h3 id="dont-"><a class="header" href="#dont-">DON'T âŒ</a></h3>
<ul>
<li><strong>Deep nesting</strong>: Max 3 levels</li>
<li><strong>Long functions</strong>: Split at CC &gt; 10</li>
<li><strong>Complex conditions</strong>: Extract to named functions</li>
<li><strong>Mix concerns</strong>: One function = one responsibility</li>
<li><strong>Skip refactoring</strong>: High CC = technical debt</li>
</ul>
<h2 id="decy-complexity-goals"><a class="header" href="#decy-complexity-goals">DECY Complexity Goals</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Component</th><th>Average CC</th><th>Max CC</th><th>Target</th></tr></thead><tbody>
<tr><td>Parser</td><td>4.2</td><td>8</td><td>â‰¤10</td></tr>
<tr><td>HIR</td><td>3.8</td><td>6</td><td>â‰¤10</td></tr>
<tr><td>Ownership</td><td>6.2</td><td>9</td><td>â‰¤10</td></tr>
<tr><td>Codegen</td><td>5.4</td><td>9</td><td>â‰¤10</td></tr>
<tr><td><strong>Overall</strong></td><td><strong>5.1</strong></td><td><strong>9</strong></td><td><strong>â‰¤10</strong></td></tr>
</tbody></table>
</div>
<p>All functions within target âœ…</p>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Complexity analysis in DECY:</p>
<p>âœ… <strong>Low complexity</strong>: Average CC = 5.1 across all functions
âœ… <strong>No high complexity</strong>: 0 functions exceed CC &gt; 10
âœ… <strong>Refactoring strategies</strong>: Extract functions, use match, early returns
âœ… <strong>Testing coverage</strong>: Minimum tests â‰¥ CC for each function
âœ… <strong>CI/CD integration</strong>: Automatic complexity checking
âœ… <strong>Readable code</strong>: Cognitive complexity also low
âœ… <strong>Maintainable</strong>: Easy to understand and modify</p>
<p>Low complexity = <strong>code is easy to understand and test</strong></p>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<ul>
<li><a href="./safety.html">Safety Verification</a> - Prove memory safety</li>
<li><a href="./coverage.html">Test Coverage</a> - Measure test coverage</li>
<li><a href="./mutation.html">Mutation Scores</a> - Verify test quality</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../metrics/mutation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../metrics/safety.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../metrics/mutation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../metrics/safety.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
